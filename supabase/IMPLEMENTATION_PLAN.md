# –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è RLS –∏ —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ë–î

## üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö Supabase –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö policies. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è Security issues –≤ Supabase Dashboard –∏ –∑–∞—â–∏—Ç–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∑–∞–∫–∞–∑—ã, –ª–∏–¥—ã).

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

1. **–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è** (`INVENTORY.md`)
   - –°–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∫–∞—Ä—Ç–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–æ—Å—Ç—É–ø–∞: public read-only, public insert-only, admin-only, join tables

2. **SQL –º–∏–≥—Ä–∞—Ü–∏–∏** (`migrations/`)
   - `20250216000001_enable_rls_all_tables.sql` - –≤–∫–ª—é—á–µ–Ω–∏–µ RLS
   - `20250216000002_policies_public_read_only.sql` - policies –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è
   - `20250216000003_policies_public_insert.sql` - policies –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏
   - `20250216000004_policies_join_tables.sql` - policies –¥–ª—è join —Ç–∞–±–ª–∏—Ü
   - `20250216000005_indexes_performance.sql` - –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

3. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏** (`checks.sql`)
   - SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞—É–¥–∏—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS —Å—Ç–∞—Ç—É—Å–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ policies
   - –ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤

4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - `ROLLBACK.md` - –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–π
   - `TESTING_CHECKLIST.md` - —á–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - `UNUSED_TABLES_AUDIT.md` - –∞—É–¥–∏—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü
   - `README.md` - –æ–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üéØ –¶–µ–ª–∏

- ‚úÖ –£–±—Ä–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è "RLS not enabled" –≤ Supabase Dashboard
- ‚úÖ –ó–∞—â–∏—Ç–∏—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (orders, leads)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∞–π—Ç–∞ –∏ –∞–¥–º–∏–Ω–∫–∏
- ‚úÖ –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã

## üìù –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 —á–∞—Å–∞)

1. **–ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   ```bash
   # –ß–µ—Ä–µ–∑ Supabase Dashboard ‚Üí Settings ‚Üí Database ‚Üí Backup
   # –ò–ª–∏ —á–µ—Ä–µ–∑ CLI: supabase db dump > backup.sql
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å `supabase/checks.sql` –≤ Supabase SQL Editor
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π/—Ç–µ—Å—Ç–æ–≤–æ–π –ë–î**
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
   - –ü—Ä–æ–π—Ç–∏ —á–µ–∫-–ª–∏—Å—Ç –∏–∑ `TESTING_CHECKLIST.md`

### –≠—Ç–∞–ø 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤ –ø—Ä–æ–¥–µ (30-60 –º–∏–Ω—É—Ç)

**–í–ê–ñ–ù–û**: –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –∏–ª–∏ –∫–æ–≥–¥–∞ —Ç—Ä–∞—Ñ–∏–∫ –º–∏–Ω–∏–º–∞–ª–µ–Ω.

1. **–ú–∏–≥—Ä–∞—Ü–∏—è 1: –í–∫–ª—é—á–µ–Ω–∏–µ RLS**
   ```sql
   -- –í—ã–ø–æ–ª–Ω–∏—Ç—å: 20250216000001_enable_rls_all_tables.sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞: SELECT tablename, rowsecurity FROM pg_tables WHERE schemaname = 'public';
   ```
   ‚ö†Ô∏è –ü–æ—Å–ª–µ —ç—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–∞–π—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å—Ç–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç policies!

2. **–ú–∏–≥—Ä–∞—Ü–∏—è 2: Policies –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è**
   ```sql
   -- –í—ã–ø–æ–ª–Ω–∏—Ç—å: 20250216000002_policies_public_read_only.sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–∞–π—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å, –∫–∞—Ç–∞–ª–æ–≥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   ```

3. **–ú–∏–≥—Ä–∞—Ü–∏—è 3: Policies –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏**
   ```sql
   -- –í—ã–ø–æ–ª–Ω–∏—Ç—å: 20250216000003_policies_public_insert.sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
   ```

4. **–ú–∏–≥—Ä–∞—Ü–∏—è 4: Policies –¥–ª—è join —Ç–∞–±–ª–∏—Ü**
   ```sql
   -- –í—ã–ø–æ–ª–Ω–∏—Ç—å: 20250216000004_policies_join_tables.sql
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
   ```

5. **–ú–∏–≥—Ä–∞—Ü–∏—è 5: –ò–Ω–¥–µ–∫—Å—ã**
   ```sql
   -- –í—ã–ø–æ–ª–Ω–∏—Ç—å: 20250216000005_indexes_performance.sql
   -- –î–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è
   -- –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —É—Ö—É–¥—à–∏–ª–∞—Å—å
   ```

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 —á–∞—Å–∞)

–°–ª–µ–¥–æ–≤–∞—Ç—å `TESTING_CHECKLIST.md`:
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø (–∫–∞—Ç–∞–ª–æ–≥, –±–ª–æ–≥, —Ñ–æ—Ä–º—ã)
- [ ] –ê–¥–º–∏–Ω–∫–∞ (–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (anon –Ω–µ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å orders/leads)
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –≠—Ç–∞–ø 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (24 —á–∞—Å–∞)

–í —Ç–µ—á–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö 24 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ Supabase Dashboard
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏ 401/403
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: –°–∞–π—Ç –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è RLS
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**: 
- –ü—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—ç—Ç–∞–ø–Ω–æ
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î —Å–Ω–∞—á–∞–ª–∞
- –ò–º–µ—Ç—å –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –≥–æ—Ç–æ–≤—ã–º

### –†–∏—Å–∫ 2: –§–æ—Ä–º—ã –∑–∞–∫–∞–∑–æ–≤ –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ policies –¥–ª—è INSERT —Å–æ–∑–¥–∞–Ω—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (anon key –¥–ª—è INSERT)
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è service role - —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ anon

### –†–∏—Å–∫ 3: –ê–¥–º–∏–Ω–∫–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–¥–º–∏–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getSupabaseAdmin()` (service role)
- Service role –æ–±—Ö–æ–¥–∏—Ç RLS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ï—Å–ª–∏ –∞–¥–º–∏–Ω–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç anon key - –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ service role

### –†–∏—Å–∫ 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É—Ö—É–¥—à–∏—Ç—Å—è
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –ò–Ω–¥–µ–∫—Å—ã –¥–æ–ª–∂–Ω—ã —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

## üîÑ –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–Ω –∏–∑ `ROLLBACK.md`
2. –û—Ç–∫–∞—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
4. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É
5. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:
- ‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç RLS –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π Security issues –≤ Supabase Dashboard
- ‚úÖ –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã (orders, leads –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è –ø—É–±–ª–∏—á–Ω–æ)
- ‚úÖ –°–∞–π—Ç –∏ –∞–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞ —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `checks.sql` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Supabase Dashboard
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ
4. –°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è RLS –º–æ–∂–Ω–æ:
1. –ê—É–¥–∏—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü (`UNUSED_TABLES_AUDIT.md`)
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–∞–Ω–∞–ª–∏–∑ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏
